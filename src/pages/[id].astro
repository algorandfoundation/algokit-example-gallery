---
import Layout from "../layouts/Layout.astro";
import { fetchExamplesYaml } from "../data";
import { Icon } from "astro-icon/components";
import DemoLinks from "@/components/detail-page/DemoLinks.astro";
import DescriptionPanel from "@/components/detail-page/DescriptionPanel.astro";
import Tag from "@/components/Tag.astro";
import ExampleHeader from "@/components/detail-page/ExampleHeader.astro";
import { getGithubFileContents } from "@/utils/github";
export async function getStaticPaths() {
  const examples = await fetchExamplesYaml();
  return examples.map((example) => ({
    params: { id: example.id },
    props: { example },
  }));
}

const { example } = Astro.props;
const { id, title, description, image, tags, links, author, features, type } =
  example;
const githubUrl = links.source;
// Add dynamic import using the title
console.log(
  `https://api.github.com/lempira/template-gallery-spike/main/examples/${id}/README.md`
);
const Content = await getGithubFileContents(`examples/${id}/README.md`);

// const Content = response ? await response.text() : null;
console.log({ Content });
---

<Layout title={title}>
  <main class="container px-4 mx-auto flex flex-col pt-[64px]">
    <div
      class="flex flex-col gap-2 mb-5 sticky top-0 bg-base-100 pt-6 pb-3 z-10"
    >
      <div class="flex items-center gap-2 mb-4">
        <Icon name="mdi:arrow-left" />
        <a href="/" class="link text-sm">Back to templates</a>
      </div>
      <ExampleHeader
        title={title}
        id={id}
        type={type}
        author={author}
        githubUrl={githubUrl}
        tags={tags}
      />
    </div>
    <DescriptionPanel
      description={description}
      features={features}
      image={image}
      title={title}
    />
    <div
      class="prose dark:prose-invert
  prose-h1:font-bold prose-h1:text-xl
  prose-a:text-blue-600 prose-p:text-justify prose-img:rounded-xl
  prose-headings:underline"
    >
      {Content}
    </div>
  </main>
</Layout>
